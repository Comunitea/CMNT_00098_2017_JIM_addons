<?xml version="1.0" encoding="utf-8"?>
<odoo noupdate="1">

    <!-- PRODUCT FORM BUTTON -->

    <record id="categorization_template_and_product_form_view" model="ir.ui.view">
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='group_general']" position="inside">
                <label for="categorization_percent_filled" />
                <button name="categorization_modal" class="btn-none" type="object">
                    <field name="categorization_percent_filled" widget="js_percentpie" string="Filled fields"/>
                </button>
            </xpath>
        </field>
    </record>

    <!-- PRODUCTS CATEGORIZATION FORM -->

    <record id="categorization_product_form_view" model="ir.ui.view">
        <field name="name">Product Categorization</field>
        <field name="model">product.template.categorization</field>
        <field name="arch" type="xml">
            <form string="Categorization" create="false">
                <header id="categorization_header" invisible="not context.get('default_product_id')">
                    <field name="product_id" readonly="1" class="label label-default" options="{ 'no_open': True }"/>
                </header>
                <sheet>
                    <div id="template_selection_wrapper">
                        <label for="categorization_template"/>
                        <field name="categorization_template" options="{'no_open': True, 'no_create': True}"/>
                    </div>

                    <div id="categorization_actions" class="oe_button_box" invisible="not context.get('default_product_id')">
                        <button name="edit_variant" type="object" class="btn-warning" string="Switch to Variant" attrs="{ 'invisible': [('product_id', '=', False)] }"/>
                        <button name="new_field_modal" type="object" class="btn-primary" string="New Field" groups="js_categorization.group_manage_categorization"/>
                    </div>

                    <div id="categorization_fields">
                        <group/>
                    </div>
                </sheet>
                <footer invisible="not context.get('default_product_id')">
                    <button name="write" string="Save" class="btn-primary" type="object"/>
                    <button string="Cancel" class="btn-default" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- VARIANTS CATEGORIZATION FORM -->

    <record id="categorization_variant_form_view" model="ir.ui.view">
        <field name="name">Variant Categorization</field>
        <field name="model">product.product.categorization</field>
        <field name="arch" type="xml">
            <form string="Categorization" create="false">
                <header id="categorization_header" invisible="not context.get('default_variant_id')">
                    <field name="variant_id" readonly="1" class="label label-default" options="{ 'no_open': True }"/>
                </header>
                <sheet>
                    <div id="template_selection_wrapper">
                        <field name="categorization_template" invisible="1"/>
                    </div>

                    <div id="categorization_actions" class="oe_button_box" invisible="not context.get('default_variant_id')">
                        <button name="edit_template" type="object" class="btn-warning" string="Product Template" attrs="{ 'invisible': [('variant_id', '=', False)] }"/>
                        <button name="new_field_modal" type="object" class="btn-primary" string="New Field" groups="js_categorization.group_manage_categorization"/>
                    </div>

                    <div id="categorization_fields">
                        <group/>
                    </div>
                </sheet>
                <footer invisible="not context.get('default_variant_id')">
                    <button name="write" string="Save" class="btn-primary" type="object"/>
                    <button string="Cancel" class="btn-default" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- CATEGORIZATION FILTERS -->

    <record id="categorization_product_search_by_field" model="ir.ui.view">
        <field name="model">product.template.categorization</field>
        <field name="arch" type="xml">
            <search/>
        </field>
    </record>

    <record id="categorization_variant_search_by_field" model="ir.ui.view">
        <field name="model">product.product.categorization</field>
        <field name="arch" type="xml">
            <search/>
        </field>
    </record>

    <!-- PRODUCTS CATEGORIZATED -->

    <record id="categorization_products_tree" model="ir.ui.view">
        <field name="name">Products Categorizated</field>
        <field name="model">product.template.categorization</field>
        <field name="arch" type="xml">
            <tree string="products" create="false" edit="false">
                <field name="product_id"/>
                <field name="categorization_template"/>
                <button name="go_to_product" type="object" string="View Product"/>
            </tree>
        </field>
    </record>

    <record id="categorization_variants_tree" model="ir.ui.view">
        <field name="name">Variants Categorizated</field>
        <field name="model">product.product.categorization</field>
        <field name="arch" type="xml">
            <tree string="variants" create="false" edit="false">
                <field name="variant_id"/>
                <field name="categorization_template"/>
                <button name="go_to_variant" type="object" string="View Variant"/>
            </tree>
        </field>
    </record>

    <!-- TREE ACTIONS -->

    <record id="categorization_recalculate" model="ir.actions.server">
        <field name="name">Re-calculate Categorization Percent</field>
        <field name="model_id" ref="model_product_template_categorization"/>
        <field name="state">code</field>
        <field name="code">
            for record in records:
                record.product_id.calculate_categorization_percent()
        </field>
    </record>

    <record model="ir.values" id="ir_values_categorization_recalculate_button">
        <field name="name">Re-calculate Categorization Percent</field>
        <field name="model">product.template.categorization</field>
        <field name="key2">client_action_multi</field>
        <field name="value" eval="'ir.actions.server,' + str(ref('categorization_recalculate'))" />
        <field name="key">action</field>
    </record>

    <!-- MENU ACTIONS -->

    <record id="categorization_products" model="ir.actions.act_window">
        <field name="name">Products Categorizated</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">product.template.categorization</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record id="categorization_variants" model="ir.actions.act_window">
        <field name="name">Variants Categorizated</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">product.product.categorization</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!-- MENU LINKS -->

    <menuitem id="menu_js_categorization_products" name="Products" parent="menu_js_categorization" action="categorization_products" sequence="4" />
    <menuitem id="menu_js_categorization_variants" name="Variants" parent="menu_js_categorization" action="categorization_variants" sequence="5" />

</odoo>
