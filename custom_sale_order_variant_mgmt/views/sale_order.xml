<?xml version="1.0" encoding="utf-8"?>
<!-- Â© 2017 Comunitea
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->

<odoo>
    <data>

        <record id="sale_order_variants" model="ir.ui.view">
            <field name="name">sale.order.form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <field name="order_line" position="attributes">
                    <attribute name="readonly">1</attribute>
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="order_line" position="after">
                    <field name="template_lines" mode="tree" attrs="{'readonly': [('state', 'in', ('done','cancel'))]}">
                        <tree editable="bottom">
                            <field name="product_template" attrs="{'readonly': [('lines_qty', '&gt;', 1)]}"/>
                            <field name="product_id" invisible="1"/>
                            <field name="name"/>
                            <field name="lines_qty"/>
                            <field name="product_uom_qty" attrs="{'readonly': [('lines_qty', '&gt;', 1)]}"/>
                            <field name="product_uom" />
                            <field name="analytic_tag_ids" groups="analytic.group_analytic_accounting" widget="many2many_tags"  attrs="{'readonly': [('lines_qty', '&gt;', 1)]}"/>
                            <field name="route_id" groups="sale_stock.group_route_so_lines"/>
                            <field name="price_unit"  attrs="{'readonly': [('lines_qty', '&gt;', 1)]}"/>
                            <field name="purchase_price" groups="base.group_user"  attrs="{'readonly': [('lines_qty', '&gt;', 1)]}"/>
                            <field name="tax_id" widget="many2many_tags" domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id)]"/>
                            <field name="discount"  attrs="{'readonly': [('lines_qty', '&gt;', 1)]}"/>
                            <field name="price_subtotal" widget="monetary" groups="sale.group_show_price_subtotal"/>
                            <field name="product_attribute_value_ids" invisible="1"/>
                            <field name="state" invisible="1"/>
                            <button name="%(sale_order_variant_mgmt.action_sale_manage_variant)d"
                                type="action"
                                string="Modify Variants"
                                icon="fa-th"
                                class="oe_edit_only"
                                context="{'default_product_tmpl_id': product_template}"
                                attrs="{'invisible': ['|', ('state', 'not in', ('draft', 'sent')), ('product_attribute_value_ids', '=', [])]}" />
                        </tree>
                    </field>
                </field>
            </field>
        </record>

    </data>
</odoo>
